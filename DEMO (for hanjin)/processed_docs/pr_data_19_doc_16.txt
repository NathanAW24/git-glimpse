Pull Request Number: 1753
Title: Fix/slider tooltip android position
Base Branch: feat/slider
Head Branch: fix/slider-tooltip-android-position
Author: jrgarciadev
URL: https://github.com/nextui-org/nextui/pull/1753
State: MERGED
Created At: 2023-10-07T18:52:21Z
Merged At: 2023-10-07T20:13:34Z
Participants: jrgarciadev, jguddas

Description:
Base
#1751
üìù Description
Always update the Slider tooltip position when the thumb value changes
üí£ Is this a breaking change (Yes/No): No

üìù Additional Information

  
    
    

    CleanShot.2023-10-07.at.15.42.51.mp4

Commits:
- feat(slider): custom styles story added\n- fix(slider): tooltip update position dependecies added\n- fix(popover): arrow placements improved\n- fix(slider): conflicts\n

Labels:


Comments:
- changeset-bot: ###  ‚ö†Ô∏è  No Changeset found

Latest commit: 931c4f9381ea9a99ae29e4d15c48578bd59cd750

Merging this PR will not cause a version bump for any packages. If these changes should not result in a new version, you're good to go. **If these changes should result in a version bump, you need to add a changeset.**

<details><summary>This PR includes no changesets</summary>

  When changesets are added to this PR, you'll see the packages that this PR includes changesets for and the associated semver types

</details>

[Click here to learn what changesets are, and how to add one](https://github.com/changesets/changesets/blob/main/docs/adding-a-changeset.md).

[Click here if you're a maintainer who wants to add a changeset to this PR](https://github.com/nextui-org/nextui/new/fix/slider-tooltip-android-position?filename=.changeset/nervous-phones-know.md&value=---%0A%22%40nextui-org%2Fdocs%22%3A%20patch%0A%22%40nextui-org%2Fslider%22%3A%20patch%0A%22%40nextui-org%2Ftooltip%22%3A%20patch%0A%22%40nextui-org%2Ftheme%22%3A%20patch%0A---%0A%0AFix%2Fslider%20tooltip%20android%20position%0A)

\n- vercel: [vc]: #bF8+AlBQld31NsV03xEVGJgL/njiOBMHVFvtaalEM4E=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJuZXh0dWktZG9jcy12MiIsInJvb3REaXJlY3RvcnkiOiJhcHBzL2RvY3MiLCJpbnNwZWN0b3JVcmwiOiJodHRwczovL3ZlcmNlbC5jb20vbmV4dHVpLW9yZy9uZXh0dWktZG9jcy12Mi9EaG5aazhkVGk5Y3N0c01hN1luc29lWGtvWm8xIiwicHJldmlld1VybCI6Im5leHR1aS1kb2NzLXYyLWdpdC1maXgtc2xpZGVyLXRvb2x0aXAtYW5kcm9pZC1lYWFhYzEtbmV4dHVpLW9yZy52ZXJjZWwuYXBwIiwibmV4dENvbW1pdFN0YXR1cyI6IkRFUExPWUVEIiwibGl2ZUZlZWRiYWNrIjp7InJlc29sdmVkIjowLCJ1bnJlc29sdmVkIjowLCJ0b3RhbCI6MCwibGluayI6Im5leHR1aS1kb2NzLXYyLWdpdC1maXgtc2xpZGVyLXRvb2x0aXAtYW5kcm9pZC1lYWFhYzEtbmV4dHVpLW9yZy52ZXJjZWwuYXBwIn19LHsibmFtZSI6Im5leHR1aS1zdG9yeWJvb2stdjIiLCJyb290RGlyZWN0b3J5IjoicGFja2FnZXMvc3Rvcnlib29rIiwiaW5zcGVjdG9yVXJsIjoiaHR0cHM6Ly92ZXJjZWwuY29tL25leHR1aS1vcmcvbmV4dHVpLXN0b3J5Ym9vay12Mi9CR2NGR29TSkg3UTQ0RkxwVjZ4UVlGQTNIaEFkIiwicHJldmlld1VybCI6Im5leHR1aS1zdG9yeWJvb2stdjItZ2l0LWZpeC1zbGlkZXItdG9vbHRpcC1hbi01Mzk5MmUtbmV4dHVpLW9yZy52ZXJjZWwuYXBwIiwibmV4dENvbW1pdFN0YXR1cyI6IkRFUExPWUVEIiwibGl2ZUZlZWRiYWNrIjp7InJlc29sdmVkIjowLCJ1bnJlc29sdmVkIjowLCJ0b3RhbCI6MCwibGluayI6Im5leHR1aS1zdG9yeWJvb2stdjItZ2l0LWZpeC1zbGlkZXItdG9vbHRpcC1hbi01Mzk5MmUtbmV4dHVpLW9yZy52ZXJjZWwuYXBwIn19XX0=
**The latest updates on your projects**. Learn more about [Vercel for Git ‚ÜóÔ∏é](https://vercel.link/github-learn-more)

| Name | Status | Preview | Comments | Updated (UTC) |
| :--- | :----- | :------ | :------- | :------ |
| **nextui-docs-v2** | ‚úÖ Ready ([Inspect](https://vercel.com/nextui-org/nextui-docs-v2/DhnZk8dTi9cstsMa7YnsoeXkoZo1)) | [Visit Preview](https://vercel.live/open-feedback/nextui-docs-v2-git-fix-slider-tooltip-android-eaaac1-nextui-org.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | üí¨ [**Add feedback**](https://vercel.live/open-feedback/nextui-docs-v2-git-fix-slider-tooltip-android-eaaac1-nextui-org.vercel.app?via=pr-comment-feedback-link) | Oct 7, 2023 8:17pm |
| **nextui-storybook-v2** | ‚úÖ Ready ([Inspect](https://vercel.com/nextui-org/nextui-storybook-v2/BGcFGoSJH7Q44FLpV6xQYFA3HhAd)) | [Visit Preview](https://vercel.live/open-feedback/nextui-storybook-v2-git-fix-slider-tooltip-an-53992e-nextui-org.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | üí¨ [**Add feedback**](https://vercel.live/open-feedback/nextui-storybook-v2-git-fix-slider-tooltip-an-53992e-nextui-org.vercel.app?via=pr-comment-feedback-link) | Oct 7, 2023 8:17pm |


\n

Files Changed:
- apps/docs/content/docs/components/tooltip.mdx (modified, 3 changes)\n  Patch: @@ -13,7 +13,7 @@ Tooltips display a brief, informative message that appears when a user interacts
 
 ---
 
-<CarbonAd/>
+<CarbonAd />
 
 ## Import
 
@@ -137,6 +137,7 @@ You can customize the `Tooltip` component by passing custom Tailwind CSS classes
 | shouldCloseOnBlur         | `boolean`                                                                   | Whether the tooltip should close when focus is lost or moves outside it.                                     | `true`          |
 | motionProps               | [MotionProps](#motion-props)                                                | The props to modify the framer motion animation. Use the `variants` API to create your own animation.        | -               |
 | portalContainer           | `HTMLElement`                                                               | The container element in which the overlay portal will be placed.                                            | `document.body` |
+| updatePositionDeps        | `any[]`                                                                     | The dependencies to force the tooltip position update.                                                       | `[]`            |
 | isDisabled                | `boolean`                                                                   | Whether the tooltip is disabled.                                                                             | `false`         |
 | disableAnimation          | `boolean`                                                                   | Whether the tooltip is animated.                                                                             | `false`         |
 | classNames                | `Record<"base"ÔΩú"arrow", string>`                                           | Allows to set custom class names for the tooltip slots.                                                      | -               |\n- packages/components/slider/src/use-slider-thumb.ts (modified, 7 changes)\n  Patch: @@ -117,10 +117,11 @@ export function useSliderThumb(props: UseSliderThumbProps) {
       renderOutput && typeof renderOutput === "function" ? renderOutput(`${value}`) : value;
 
     return {
-      placement: isVertical ? "right" : "top",
       ...tooltipProps,
-      content,
-      isOpen: isHovered || isDragging,
+      placement: tooltipProps?.placement ?? isVertical ? "right" : "top",
+      content: tooltipProps?.content ?? content,
+      updatePositionDeps: [isDragging, isHovered, value],
+      isOpen: tooltipProps?.isOpen ?? (isHovered || isDragging),
     } as TooltipProps;
   };
 \n- packages/components/slider/src/use-slider.ts (modified, 1 changes)\n  Patch: @@ -339,7 +339,6 @@ export function useSlider(originalProps: UseSliderProps) {
 
   const getEndContentProps: PropGetter = (props = {}) => ({
     "data-slot": "endContent",
-
     className: slots.endContent({class: classNames?.endContent}),
     ...props,
   });\n- packages/components/tooltip/src/use-tooltip.ts (modified, 20 changes)\n  Patch: @@ -4,7 +4,7 @@ import type {OverlayTriggerProps} from "@react-types/overlays";
 import type {HTMLMotionProps} from "framer-motion";
 import type {OverlayOptions} from "@nextui-org/aria-utils";
 
-import {ReactNode, Ref, useId, useImperativeHandle} from "react";
+import {ReactNode, Ref, useId, useImperativeHandle, useLayoutEffect} from "react";
 import {useTooltipTriggerState} from "@react-stately/tooltip";
 import {mergeProps} from "@react-aria/utils";
 import {useTooltip as useReactAriaTooltip, useTooltipTrigger} from "@react-aria/tooltip";
@@ -57,6 +57,11 @@ interface Props extends Omit<HTMLNextUIProps, "content"> {
    * @default document.body
    */
   portalContainer?: Element;
+  /**
+   * List of dependencies to update the position of the tooltip.
+   * @default []
+   */
+  updatePositionDeps?: any[];
   /**
    * Classname or List of classes to change the classNames of the element.
    * if `className` is passed, it will be added to the base slot.
@@ -105,6 +110,7 @@ export function useTooltip(originalProps: UseTooltipProps) {
     shouldCloseOnBlur = true,
     portalContainer,
     isKeyboardDismissDisabled = false,
+    updatePositionDeps = [],
     shouldCloseOnInteractOutside,
     className,
     onClose,
@@ -159,7 +165,11 @@ export function useTooltip(originalProps: UseTooltipProps) {
     state,
   );
 
-  const {overlayProps: positionProps, placement} = useOverlayPosition({
+  const {
+    overlayProps: positionProps,
+    placement,
+    updatePosition,
+  } = useOverlayPosition({
     isOpen: isOpen,
     targetRef: triggerRef,
     placement: toReactAriaPlacement(placementProp),
@@ -170,6 +180,12 @@ export function useTooltip(originalProps: UseTooltipProps) {
     containerPadding,
   });
 
+  useLayoutEffect(() => {
+    if (!updatePositionDeps.length) return;
+    // force update position when deps change
+    updatePosition();
+  }, updatePositionDeps);
+
   const {overlayProps} = useOverlay(
     {
       isOpen: isOpen,\n- packages/core/theme/src/components/popover.ts (modified, 24 changes)\n  Patch: @@ -36,36 +36,36 @@ const popover = tv({
       // visibility
       "data-[arrow=true]:before:block",
       // top
-      "data-[placement=top]:before:-bottom-1",
+      "data-[placement=top]:before:-bottom-[calc(theme(spacing.5)/4_-_1px)]",
       "data-[placement=top]:before:left-1/2",
       "data-[placement=top]:before:-translate-x-1/2",
-      "data-[placement=top-start]:before:-bottom-1",
+      "data-[placement=top-start]:before:-bottom-[calc(theme(spacing.5)/4_-_1px)]",
       "data-[placement=top-start]:before:left-3",
-      "data-[placement=top-end]:before:-bottom-1",
+      "data-[placement=top-end]:before:-bottom-[calc(theme(spacing.5)/4_-_1px)]",
       "data-[placement=top-end]:before:right-3",
       // bottom
-      "data-[placement=bottom]:before:-top-1",
+      "data-[placement=bottom]:before:-top-[calc(theme(spacing.5)/4_-_1px)]",
       "data-[placement=bottom]:before:left-1/2",
       "data-[placement=bottom]:before:-translate-x-1/2",
-      "data-[placement=bottom-start]:before:-top-1",
+      "data-[placement=bottom-start]:before:-top-[calc(theme(spacing.5)/4_-_1px)]",
       "data-[placement=bottom-start]:before:left-3",
-      "data-[placement=bottom-end]:before:-top-1",
+      "data-[placement=bottom-end]:before:-top-[calc(theme(spacing.5)/4_-_1px)]",
       "data-[placement=bottom-end]:before:right-3",
       // left
-      "data-[placement=left]:before:-right-[calc(theme(spacing.1)_-_1px)]",
+      "data-[placement=left]:before:-right-[calc(theme(spacing.5)/4_-_2px)]",
       "data-[placement=left]:before:top-1/2",
       "data-[placement=left]:before:-translate-y-1/2",
-      "data-[placement=left-start]:before:-right-[calc(theme(spacing.1)_-_1.5px)]",
+      "data-[placement=left-start]:before:-right-[calc(theme(spacing.5)/4_-_3px)]",
       "data-[placement=left-start]:before:top-1/4",
-      "data-[placement=left-end]:before:-right-[calc(theme(spacing.1)_-_1.5px)]",
+      "data-[placement=left-end]:before:-right-[calc(theme(spacing.5)/4_-_3px)]",
       "data-[placement=left-end]:before:bottom-1/4",
       // right
-      "data-[placement=right]:before:-left-[calc(theme(spacing.1)_-_1px)]",
+      "data-[placement=right]:before:-left-[calc(theme(spacing.5)/4_-_2px)]",
       "data-[placement=right]:before:top-1/2",
       "data-[placement=right]:before:-translate-y-1/2",
-      "data-[placement=right-start]:before:-left-[calc(theme(spacing.1)_-_1.5px)]",
+      "data-[placement=right-start]:before:-left-[calc(theme(spacing.5)/4_-_3px)]",
       "data-[placement=right-start]:before:top-1/4",
-      "data-[placement=right-end]:before:-left-[calc(theme(spacing.1)_-_1.5px)]",
+      "data-[placement=right-end]:before:-left-[calc(theme(spacing.5)/4_-_3px)]",
       "data-[placement=right-end]:before:bottom-1/4",
       // focus ring
       ...dataFocusVisibleClasses,\n
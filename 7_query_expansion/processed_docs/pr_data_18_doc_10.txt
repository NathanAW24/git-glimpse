Pull Request Number: 1927
Title: fix(system): extend variants fuction adapted
Base Branch: main
Head Branch: fix/1921
Author: jrgarciadev
URL: https://github.com/nextui-org/nextui/pull/1927
State: MERGED
Created At: 2023-11-08T13:53:11Z
Merged At: 2023-11-08T14:15:10Z
Participants: jrgarciadev

Description:
Closes #1921
‚õ≥Ô∏è Current behavior (updates)
The extendVariants function doesn't consider the props variants when having default ones defined.
üöÄ New behavior
The extendVariants function prioritizes the prop variants over the default ones
üí£ Is this a breaking change (Yes/No): No

üìù Additional Information

Commits:
- fix(system): extend variants fuction adapted\n

Labels:


Comments:
- changeset-bot: ###  ü¶ã  Changeset detected

Latest commit: a784e5353a5c671b70d2483d8530c1e39a015c43

**The changes in this PR will be included in the next version bump.**

<details><summary>This PR includes changesets to release 27 packages</summary>

  | Name                           | Type  |
| ------------------------------ | ----- |
| @nextui-org/system-rsc         | Patch |
| @nextui-org/badge              | Patch |
| @nextui-org/code               | Patch |
| @nextui-org/divider            | Patch |
| @nextui-org/kbd                | Patch |
| @nextui-org/skeleton           | Patch |
| @nextui-org/spacer             | Patch |
| @nextui-org/spinner            | Patch |
| @nextui-org/system             | Patch |
| @nextui-org/react              | Patch |
| @nextui-org/accordion          | Patch |
| @nextui-org/listbox            | Patch |
| @nextui-org/menu               | Patch |
| @nextui-org/table              | Patch |
| @nextui-org/autocomplete       | Patch |
| @nextui-org/button             | Patch |
| @nextui-org/select             | Patch |
| @nextui-org/dropdown           | Patch |
| @nextui-org/modal              | Patch |
| @nextui-org/navbar             | Patch |
| @nextui-org/popover            | Patch |
| @nextui-org/slider             | Patch |
| @nextui-org/snippet            | Patch |
| @nextui-org/tabs               | Patch |
| @nextui-org/tooltip            | Patch |
| @nextui-org/aria-utils         | Patch |
| @nextui-org/framer-transitions | Patch |

</details>

Not sure what this means? [Click here  to learn what changesets are](https://github.com/changesets/changesets/blob/main/docs/adding-a-changeset.md).

[Click here if you're a maintainer who wants to add another changeset to this PR](https://github.com/nextui-org/nextui/new/fix/1921?filename=.changeset/gold-radios-add.md&value=---%0A%22%40nextui-org%2Fdocs%22%3A%20patch%0A%22%40nextui-org%2Fsystem-rsc%22%3A%20patch%0A%22%40nextui-org%2Fsystem%22%3A%20patch%0A---%0A%0Afix(system)%3A%20extend%20variants%20fuction%20adapted%0A)

\n- vercel: [vc]: #ZzxgN6giw5AVTBpKYKZPlqDfeiKRmsWwyoz9eJNCDe0=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJuZXh0dWktZG9jcy12MiIsInJvb3REaXJlY3RvcnkiOiJhcHBzL2RvY3MiLCJpbnNwZWN0b3JVcmwiOiJodHRwczovL3ZlcmNlbC5jb20vbmV4dHVpLW9yZy9uZXh0dWktZG9jcy12Mi9CdlR4U3NVdERMR2FKODJnekhtTm5yTWFMQkxNIiwicHJldmlld1VybCI6Im5leHR1aS1kb2NzLXYyLWdpdC1maXgtMTkyMS1uZXh0dWktb3JnLnZlcmNlbC5hcHAiLCJuZXh0Q29tbWl0U3RhdHVzIjoiREVQTE9ZRUQiLCJsaXZlRmVlZGJhY2siOnsicmVzb2x2ZWQiOjAsInVucmVzb2x2ZWQiOjAsInRvdGFsIjowLCJsaW5rIjoibmV4dHVpLWRvY3MtdjItZ2l0LWZpeC0xOTIxLW5leHR1aS1vcmcudmVyY2VsLmFwcCJ9fSx7Im5hbWUiOiJuZXh0dWktc3Rvcnlib29rLXYyIiwicm9vdERpcmVjdG9yeSI6InBhY2thZ2VzL3N0b3J5Ym9vayIsImluc3BlY3RvclVybCI6Imh0dHBzOi8vdmVyY2VsLmNvbS9uZXh0dWktb3JnL25leHR1aS1zdG9yeWJvb2stdjIvMmIxTFdBVXZmUGZHcTc2QnZIS2pVUExnZTRxUCIsInByZXZpZXdVcmwiOiJuZXh0dWktc3Rvcnlib29rLXYyLWdpdC1maXgtMTkyMS1uZXh0dWktb3JnLnZlcmNlbC5hcHAiLCJuZXh0Q29tbWl0U3RhdHVzIjoiREVQTE9ZRUQifV19
**The latest updates on your projects**. Learn more about [Vercel for Git ‚ÜóÔ∏é](https://vercel.link/github-learn-more)

| Name | Status | Preview | Comments | Updated (UTC) |
| :--- | :----- | :------ | :------- | :------ |
| **nextui-docs-v2** | ‚úÖ Ready ([Inspect](https://vercel.com/nextui-org/nextui-docs-v2/BvTxSsUtDLGaJ82gzHmNnrMaLBLM)) | [Visit Preview](https://vercel.live/open-feedback/nextui-docs-v2-git-fix-1921-nextui-org.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | üí¨ [**Add feedback**](https://vercel.live/open-feedback/nextui-docs-v2-git-fix-1921-nextui-org.vercel.app?via=pr-comment-feedback-link) | Nov 8, 2023 1:55pm |
| **nextui-storybook-v2** | ‚úÖ Ready ([Inspect](https://vercel.com/nextui-org/nextui-storybook-v2/2b1LWAUvfPfGq76BvHKjUPLge4qP)) | [Visit Preview](https://nextui-storybook-v2-git-fix-1921-nextui-org.vercel.app) |  |  Nov 8, 2023 1:55pm |


\n

Files Changed:
- .changeset/witty-colts-invent.md (added, 5 changes)\n  Patch: @@ -0,0 +1,5 @@
+---
+"@nextui-org/system-rsc": patch
+---
+
+Fix #1921 `extendVariants` function adapted to consider props variants over `defaultVariants`.\n- apps/docs/app/examples/perf/page.tsx (modified, 6 changes)\n  Patch: @@ -182,7 +182,9 @@ const MyButton2 = extendVariants(Button, {
       xl: "px-12 py-6 text-xl",
     },
   },
-  defaultVariants: {},
+  defaultVariants: {
+    color: "foreground",
+  },
 });
 
 const usersData = [
@@ -544,7 +546,7 @@ export default function NextUIPerf() {
 
       <Button>Click Me!</Button>
 
-      <MyButton2 color="foreground">Press Me!</MyButton2>
+      <MyButton2 color="primary">Press Me!</MyButton2>
 
       <Pagination
         showControls\n- packages/core/system-rsc/src/extend-variants.js (modified, 73 changes)\n  Patch: @@ -21,7 +21,40 @@ function getSlots(variants) {
     : {};
 }
 
-function getClassNamesWithProps({props, defaultVariants, customTv, hasSlots}) {
+function getClassNamesWithProps({
+  props = {},
+  variants,
+  slots,
+  defaultVariants,
+  compoundVariants,
+  hasSlots,
+  opts,
+}) {
+  // Do not apply default variants when the props variant is different
+  if (defaultVariants && typeof defaultVariants === "object") {
+    for (const key in defaultVariants) {
+      const value = defaultVariants[key];
+      const propValue = props?.[key];
+
+      if (propValue && propValue !== value) {
+        delete defaultVariants[key];
+      }
+    }
+  }
+
+  const customTv = tv(
+    {
+      variants,
+      defaultVariants,
+      compoundVariants,
+      ...(hasSlots && {slots}),
+    },
+    {
+      twMerge: opts.twMerge ?? true,
+      twMergeConfig: opts.twMergeConfig ?? {},
+    },
+  );
+
   const [baseProps, variantProps] = mapPropsVariants(props, customTv.variantKeys, false);
 
   const newProps = {...defaultVariants, ...baseProps};
@@ -62,26 +95,21 @@ export function extendVariants(BaseComponent, styles = {}, opts = {}) {
   const slots = getSlots(variants);
   const hasSlots = typeof slots === "object" && Object.keys(slots).length !== 0;
 
-  const customTv = tv(
-    {
-      variants,
-      defaultVariants,
-      compoundVariants,
-      ...(hasSlots && {slots}),
-    },
-    {
-      twMerge: opts.twMerge ?? true,
-      twMergeConfig: opts.twMergeConfig ?? {},
-    },
-  );
-
   const ForwardedComponent = React.forwardRef((originalProps = {}, ref) => {
-    const newProps = getClassNamesWithProps({
-      props: originalProps,
-      defaultVariants,
-      customTv,
-      hasSlots,
-    });
+    const newProps = React.useMemo(() =>
+      getClassNamesWithProps(
+        {
+          slots,
+          variants,
+          compoundVariants,
+          props: originalProps,
+          defaultVariants,
+          hasSlots,
+          opts,
+        },
+        [originalProps],
+      ),
+    );
 
     return React.createElement(BaseComponent, {...originalProps, ...newProps, ref});
   });
@@ -90,10 +118,13 @@ export function extendVariants(BaseComponent, styles = {}, opts = {}) {
   if (BaseComponent.getCollectionNode) {
     ForwardedComponent.getCollectionNode = (itemProps) => {
       const newProps = getClassNamesWithProps({
+        slots,
+        variants,
+        compoundVariants,
         props: itemProps,
         defaultVariants,
-        customTv,
         hasSlots,
+        opts,
       });
 
       return BaseComponent.getCollectionNode({...itemProps, ...newProps});\n